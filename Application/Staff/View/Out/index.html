<include file="Base:header" />

</head>

<body>
    <div id="wrapper">
        <include file="Base:slibar" />

        <div id="page-wrapper" class="gray-bg dashbard-1">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                    <div class="navbar-header">
                        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="icon-reorder"></i> </a>
                        <form role="search" class="navbar-form-custom" method="post" action="search_results.html">
                            <div class="form-group">
                                <input type="text" placeholder="请输入您需要查找的内容 …" class="form-control" name="top-search" id="top-search">
                            </div>
                        </form>
                    </div>
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <span class="m-r-sm text-muted welcome-message"><a href="index.html" title="返回首页"><i class="icon-home"></i></a>欢迎使用</span>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle count-info" data-toggle="dropdown" href="index.html#">
                                <i class="icon-envelope"></i> <span class="label label-warning">16</span>
                            </a>
                            <ul class="dropdown-menu dropdown-messages">
                                <li>
                                    <div class="dropdown-messages-box">
                                        <a href="profile.html" class="pull-left">
                                            <img alt="image" class="img-circle" src="__IMG__/a7.jpg">
                                        </a>
                                        <div class="media-body">
                                            <small class="pull-right">46小时前</small>
                                            <strong>小四</strong> 项目已处理完结
                                            <br>
                                            <small class="text-muted">3天前 2014.11.8</small>
                                        </div>
                                    </div>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div class="dropdown-messages-box">
                                        <a href="profile.html" class="pull-left">
                                            <img alt="image" class="img-circle" src="__IMG__/a4.jpg">
                                        </a>
                                        <div class="media-body ">
                                            <small class="pull-right text-navy">25小时前</small>
                                            <strong>国民岳父</strong> 这是一条测试信息
                                            <br>
                                            <small class="text-muted">昨天</small>
                                        </div>
                                    </div>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div class="text-center link-block">
                                        <a href="mailbox.html">
                                            <i class="icon-envelope"></i> <strong> 查看所有消息</strong>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle count-info" data-toggle="dropdown" href="index.html#">
                                <i class="icon-bell"></i> <span class="label label-primary">8</span>
                            </a>
                            <ul class="dropdown-menu dropdown-alerts">
                                <li>
                                    <a href="mailbox.html">
                                        <div>
                                            <i class="icon-envelope fa-fw"></i> 您有16条未读消息
                                            <span class="pull-right text-muted small">4分钟前</span>
                                        </div>
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="profile.html">
                                        <div>
                                            <i class="icon-qq fa-fw"></i> 3条新回复
                                            <span class="pull-right text-muted small">12分钟钱</span>
                                        </div>
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div class="text-center link-block">
                                        <a href="notifications.html">
                                            <strong>查看所有 </strong>
                                            <i class="icon-angle-right"></i>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a href="{:U('Public/login')}">
                                <i class="icon-signout"></i> 退出
                            </a>
                        </li>
                    </ul>

                </nav>
            </div>
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>外出签单</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="index.html">主页</a>
                        </li>
                        <li>
                            <a>表单</a>
                        </li>
                        <li>
                            <strong>表单验证</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">

                </div>
            </div>
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>外出填单</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="form_basic.html#">
                                        <i class="fa fa-wrench"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-user">
                                        <li><a href="form_basic.html#">选项1</a>
                                        </li>
                                        <li><a href="form_basic.html#">选项2</a>
                                        </li>
                                    </ul>
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <form class="form-horizontal m-t" id="signupForm" name="sub_form">
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">日期：</label>
                                        <div class="col-sm-6">
                                            <input id="signDate" name="signDate" type="text" class="form-control layer-date" aria-required="true" aria-invalid="true" class="error" placeholder="签单日期" <if condition="I('id') neq ''">value="{$result['signdate']|date='Y/m/d H:i:s',###}"</if>>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">时间：</label>
                                        <div class="col-sm-6">
                                            <input id="start" name="startDate" class="form-control layer-date" placeholder="外出时间" <if condition="I('id') neq ''">value="{$result['startdate']|date='Y/m/d H:i:s',###}"</if>>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">预计用时：</label>
                                        <div class="col-sm-3">
                                            <input id="expected" name="expected" class="form-control" type="text" aria-required="true" aria-invalid="true" class="error" placeholder="如：2h" value="{$result['expectedtime']}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">外出原因：</label>
                                        <div class="col-sm-8">
                                            <textarea class="form-control" aria-required="true" required="" name="reason">{$result['outreason']}</textarea>
                                        </div>
                                    </div>
                                    <if condition="in_array($result['status'],array(0,''))">
                                        <div class="form-group">
                                            <div class="col-sm-8 col-sm-offset-3">
                                                <button class="btn btn-primary" type="submit">提交</button>
                                            </div>
                                        </div>
                                    </if>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>回岗填单</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="form_basic.html#">
                                        <i class="fa fa-wrench"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-user">
                                        <li><a href="form_basic.html#">选项1</a>
                                        </li>
                                        <li><a href="form_basic.html#">选项2</a>
                                        </li>
                                    </ul>
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <form class="form-horizontal m-t " id="signdownForm" name="re_form">
                                    <div class="form-group ">
                                        <label class="col-sm-3 control-label">时间：</label>
                                        <div class="col-sm-6 ">
                                            <input type="hidden" name="id" value="<php>echo I('id')</php>">
                                            <input  name="endDate" id="endDate" class="form-control layer-date" placeholder="回岗时间" <if condition="$result['status'] eq 1">value="{$result['enddate']|date='Y/m/d H:i:s',###}" </if>>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">提前或者晚归原因：</label>
                                        <div class="col-sm-8">
                                            <textarea class="form-control" name="preReason"><if condition="$result['status'] eq 1">{$result['expectedreason']}</if></textarea>
                                        </div>
                                    </div>
                                    <if condition="session('uid') neq 5">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">提交部门经理签字：</label>
                                            <div class="col-sm-9">  <volist name="data1" id="vo">
                                                <label class="checkbox-inline radio i-checks"> 
                                                <input type="radio" value="{$vo.uid}" name="manager"><i></i>{$vo.username}
                                                </label>  </volist>                          
                                            </div>
                                        </div>
                                    </if>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">提交行政总监签字：</label>
                                        <div class="col-sm-9"> <volist name="data2" id="vo">
                                            <label class="checkbox-inline radio i-checks">   
                                            <input type="radio" value="{$vo.uid}" name="director"><i></i>{$vo.username}
                                            </label></volist>
                                        </div>
                                    </div>
                                    <if condition="$result['status'] eq 0">
                                        <div class="form-group">
                                            <div class="col-sm-8 col-sm-offset-3">
                                                <button class="btn btn-primary" type="submit">提交</button>
                                            </div>
                                        </div>
                                    </if>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="footer">
                <div class="pull-right">
                    By：<a href="http://www.zi-han.net" target="_blank">zihan's blog</a>
                </div>
                <div>
                    <strong>Copyright</strong> H+ &copy; 2014
                </div>
            </div>

        </div>
    </div>


    </div>

    <!-- Custom and plugin javascript -->
    <script src="__JS__/hplus.js"></script>
    <script src="__STATIC__/pace/pace.min.js"></script>
    <!-- iCheck -->
    <link href="__STATIC__/iCheck/skins/all.css" rel="stylesheet">
    <script src="__STATIC__/iCheck/icheck.min.js"></script>
    <!-- layerdate -->
    <script src="__STATIC__/layer/laydate/laydate.js"></script>

    <script>
        $(document).ready(function(){
            var res=new RegExp('id');
            if(res.test(window.location.href)){
                $('input,textarea,button',$('form[name="sub_form"]')).attr('disabled','disabled');
            }else{
                $('input,textarea,button',$('form[name="re_form"]')).attr('disabled','disabled');
            }
            $('.i-checks').iCheck({
                    checkboxClass: 'icheckbox_square-green',
                    radioClass: 'iradio_square-green',
                }); 
        });      
        //导航高亮
        highlight_subnav('{:U("Out/index")}');

        //以下为修改jQuery Validation插件兼容Bootstrap的方法，没有直接写在插件中是为了便于插件升级
        $.validator.setDefaults({
            highlight: function (element) {
                $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
            },
            success: function (element) {
                element.closest('.form-group').removeClass('has-error').addClass('has-success');
            },
            errorElement: "span",
            errorClass: "help-block m-b-none",
            validClass: "help-block m-b-none"


        });

         //以下为官方示例
        $().ready(function () {
            // validate signup form on keyup and submit
            $("#signupForm").validate({ 
                rules: {
                    signDate: {
                        required : true,
                        date : true
                    },
                    expected : {
                        required : true,
                        expectedEvent : true
                    },
                    startDate: {
                        required : true,
                        date : true
                    },
                    reason : "required"
                },
                messages: {
                    signDate: {
                        required : "请输入签单时间",
                        date : "日期格式不对，请重填"
                    },
                    startDate: {
                        required: "请输入外出时间",
                        date : "日期格式不对，请重填"
                    },
                    expected: {
                        required : "请输入预计时间",
                        expectedEvent : "格式错误"
                    },
                    reason : "请输入外出原因"
                },
                submitHandler: function(form) {  //通过之后回调 
                    var param = $("#signupForm").serialize();

                    $.ajax({ 
                        url : "{:U('Out/signUp')}", 
                        type : "POST", 
                        dataType : "json", 
                        data: param, 
                        success : function(result) { 
                            if(result.status){
                                layer.alert(result.info,{icon:6})
                            }else{
                                layer.alert(result.info,{icon:5})
                            }
                        } 
                    }); 
                } 
            });
            
            $("#signdownForm").validate({ 
                rules: {
                    endDate: {
                        required : true,
                        date : true
                    }
                },
                messages: {
                    endDate: {
                        required : "请输入回岗时间",
                        date : "日期格式不对，请重填"
                    }
                },
                submitHandler: function(form) {  //通过之后回调 
                    layer.confirm('确认提交？',function(){
                        var param = $("#signdownForm").serialize(); 
                        alert(param);
                        $.ajax({ 
                            url : "{:U('Out/signDown')}", 
                            type : "POST", 
                            dataType : "json", 
                            data: param, 
                            success : function(result) { 
                                if(result.status){
                                    layer.alert(result.info,{icon:6});
                                    window.location.href="{:U('lists')}";
                                }else{
                                    layer.alert(result.info,{icon:5})
                                }
                            } 
                        }); 
                    })
                    
                } 
            });

            jQuery.validator.addMethod("expectedEvent", function(value, element) { 
                var preg = /^\d+(\.\d+)?h$/; 
                return this.optional(element) || (preg.test(value)); 
            }, "格式错误"); 
        });

        // layerdata
        laydate.skin('molv');

         //日期范围限制
        var start = {
            elem: '#start',
            format: 'YYYY/MM/DD hh:mm:ss',
            min: laydate.now(), //设定最小日期为当前日期
            max: '2099-06-16 23:59:59', //最大日期
            istime: true,
            istoday: false,
            choose: function (datas) {
            }
        };
        var endDate = {
            elem: '#endDate',
            format: 'YYYY/MM/DD hh:mm:ss',
            min: laydate.now(),
            max: '2099-06-16 23:59:59',
            istime: true,
            istoday: false,
            choose: function (datas) {
            }
        };
        var signDate = {
            elem: '#signDate',
            format: 'YYYY/MM/DD hh:mm:ss',
            min: laydate.now(),
            max: '2099-06-16 23:59:59',
            istime: true,
            istoday: false,
            choose: function (datas) {
                 //结束日选好后，重置开始日的最大日期
            }
        };
        laydate(signDate);
        laydate(start);
        laydate(endDate);

    </script>

</body>

</html>
